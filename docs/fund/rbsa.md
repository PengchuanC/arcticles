---
title: 基金风格分析
icon: fund
date: 2024-01-06
category:
  - 基金研究
tag:
  - python
  - RBSA
  - 基金
---

RBSA，即基于收益的风格分析（Return-Based Style Analysis），是一种通过历史回报率来确定投资组合风格或资产配置的技术。这种分析方法最初由William Sharpe提出，旨在评估基金经理的投资风格和对基准的偏离情况。

<!-- more -->


## 基金风格分析的方法

基金风格分析是指对基金的投资风格做出大盘、中盘、小盘和成长、价值的六区间或四区间分类，比如大盘价值、小盘成长等，常用方法主要是基于持仓来分析和基于收益率表现来分析：

1. **风格指数分析**： 使用基金收益与风格指数对比分析，将其归因于不同的风格因子，可以通过相关性、回归分析等方法来分析基金的风格。

2. **持仓比例分析**： 根据基金的持仓，按照成分股的风格和比例来确定基金的风格。


## RBSA基本概念

RBSA通常更关注资产的风格和类别配置，而不是直接优化预期收益。它使用历史回报数据来估计投资组合中各资产类别的权重，这些权重则反映了投资组合对各类风格或因子的敞口大小。RBSA的目标是找到一个资产组合，这个资产组合的历史表现最接近被分析的投资组合的历史表现。


尽管RBSA主要关注风格分析，但通过对比基金与基准的表现，间接地也能反映出基金的风险调整后的回报表现。如果一个投资组合的历史回报与其基准相比表现出色，我们可以推测该投资组合可能实现了超出基准的预期收益。然而，RBSA本身并不直接优化预期收益，它更多的是分析和解释投资组合的历史表现。


## RBSA基本流程

基金的 Return Based Style Analysis (RBSA) 是一种用于估计基金投资风格的方法，通常涉及以下步骤：

1. **选择基准指数**：选择一系列代表不同投资风格的基准指数（如大盘股、小盘股、成长股、价值股等）。

2. **获取数据**：收集基金和所选基准指数的历史收益率数据。

3. **回归分析**：使用多元线性回归分析，将基金的历史收益率作为因变量，各个基准指数的历史收益率作为自变量。

4. **计算权重**：回归分析的系数反映了基金投资组合对各个基准指数的暴露程度，这些系数可以解释为基金投资风格的权重。

5. **分析结果**：通过观察哪些指数的权重最高，可以了解基金主要投资于哪种类型的资产。这有助于投资者理解基金经理的投资风格和策略。

这个方法的关键在于回归分析这一步，它可以揭示基金收益与各类资产之间的关系。需要注意的是，这种分析假设基金经理的投资风格在分析期间保持一致，且所选基准指数能充分覆盖基金的投资范围。

但实际上，除了回归，我们还可以通过最优化的方式来解决这个问题：

1. **构建优化问题**：将RBSA问题构建为一个凸优化问题，其中目标函数通常是最小化基金收益和基准指数加权组合收益之间的差异。

2. **添加约束**：在优化问题中添加一些约束条件，例如基准指数权重的和为1（表示完全投资），权重非负（不允许空头持仓），可能还会包括其他的先验知识或投资限制作为约束。

3. **求解凸优化问题**：使用数学优化软件或库（如CVXOPT、SciPy等）来求解这个凸优化问题。

> [!important]
> 使用凸优化进行风格分析的主要优点在于可以直接在优化模型中加入各种实际的投资约束，使得解决方案更符合实际情况。此外，通过求解优化问题，可以确保找到全局最优解，这是传统> 最小二乘法线性回归所无法保证的。

## RBSA的最优化问题构建

### 构建问题
通常我的我们的优化目标是方差最小化，所以我们的目标函数一般为

$$ \begin{equation} \min \frac{1}{2} w^T C w \end{equation} $$

但是我们同事还是要考虑预期收益，我们需要在目标函数中添加一个关于预期收益的线性项，所以最终的目标函数为

$$ \begin{equation} \min \frac{1}{2} w^T C w - q^T w \end{equation}$$

这意味着我们不仅需要方差最小，并且指数组合的收益与实际基金的收益要尽可能接近，其中w为权重，C为协方差矩阵，q为基金实际收益与拟合收益的差。
具体来说，q向量与优化变量（即各指数的权重）的乘积 $q^Tw$表示的是基金收益相对于各指数收益的加权差异的线性部分。
而在优化中，我们希望找到一组权重，使得这个差异的平方（即通过C表示的二次项）最小。

### 约束条件
对权重的约束为

$$ \begin{equation} G \cdot w \geq h \end{equation} $$
$$ \begin{equation} A \cdot w = b \end{equation} $$

分别约束权重和为1且权重非负，这与标准的凸优化问题有些出入，需要我们在实际代码中做些变换，通常一个标准的凸优化问题形式为：

$$\begin{equation} \min \frac{1}{2} x^T P x + q^T x \end{equation}$$
$$\begin{equation} G \cdot w \leq h \end{equation} $$
$$\begin{equation} A \cdot x = b \end{equation}$$

### 伪代码求解
```python
import numpy as np
from cvxopt import matrix, solvers

# 假设我们有1支基金与3个风格指数的收益率数据
fund_returns = np.array([0.02, 0.03, 0.01, 0.03, 0.02])
index_returns = np.array([
    [0.01, 0.03, 0.02, 0.03, 0.01],  # 指数1
    [0.02, 0.02, 0.01, 0.03, 0.02],  # 指数2
    [0.03, 0.01, 0.03, 0.02, 0.03]   # 指数3
]).T

# 指数个数
n = index_returns.shape[1])

# 目标是最小化基金收益和加权指数组合收益之间的差异
# 我们使用平方差作为优化目标

# 计算协方差矩阵
cov_matrix = np.cov(fund_returns, index_returns, rowvar=False)

# 我们只关心与基准指数相关的协方差部分
P = matrix(cov_matrix[1:, 1:])
q = matrix(-cov_matrix[0, 1:])

# 添加约束条件
# 权重非负，负号将大于等于约束转为小于等于
G = matrix(-np.eye(n)
h = matrix(np.zeros(n))

# 权重和为1
A = matrix(1.0, (1, n))
b = matrix(1.0)

# 求解凸优化问题
solvers.options['show_progress'] = False
sol = solvers.qp(P, q, G, h, A, b)

# 输出结果
print(sol['x'])
```

## 实际案例

2023年权益型公募基金大部分亏损严重，导致上涨的基金显得尤为难得，我们就以热门的金元顺安元启为例，做个分析，看看2023年的计算结果是否与实际情况接近，主要是投资于小微盘。

### 准备数据

首先基金收益使用的是自2018年初到2023年底的复权单位净值数据，指数选取了巨潮的风格指数，包括大盘成长、大盘价值、小盘成长、小盘价值，以及中债总财富总值指数，来代表现金收益。

然后按月分组，对每个月的风格进行分析，得到的结果如下：

::: chart 金元顺安元启风格分析

```json
{
    "type": "bar",
    "data": {
        "labels": [
            "2018-01",
            "2018-02",
            "2018-03",
            "2018-04",
            "2018-05",
            "2018-06",
            "2018-07",
            "2018-08",
            "2018-09",
            "2018-10",
            "2018-11",
            "2018-12",
            "2019-01",
            "2019-02",
            "2019-03",
            "2019-04",
            "2019-05",
            "2019-06",
            "2019-07",
            "2019-08",
            "2019-09",
            "2019-10",
            "2019-11",
            "2019-12",
            "2020-01",
            "2020-02",
            "2020-03",
            "2020-04",
            "2020-05",
            "2020-06",
            "2020-07",
            "2020-08",
            "2020-09",
            "2020-10",
            "2020-11",
            "2020-12",
            "2021-01",
            "2021-02",
            "2021-03",
            "2021-04",
            "2021-05",
            "2021-06",
            "2021-07",
            "2021-08",
            "2021-09",
            "2021-10",
            "2021-11",
            "2021-12",
            "2022-01",
            "2022-02",
            "2022-03",
            "2022-04",
            "2022-05",
            "2022-06",
            "2022-07",
            "2022-08",
            "2022-09",
            "2022-10",
            "2022-11",
            "2022-12",
            "2023-01",
            "2023-02",
            "2023-03",
            "2023-04",
            "2023-05",
            "2023-06",
            "2023-07",
            "2023-08",
            "2023-09",
            "2023-10",
            "2023-11",
            "2023-12"
        ],
        "datasets": [
            {
                "label": "大盘成长",
                "data": [
                    0.0057,
                    0.0274,
                    0.0052,
                    0.005,
                    0.0053,
                    0.0273,
                    0.0099,
                    0.0289,
                    0.005,
                    0.1359,
                    0.0025,
                    0.0047,
                    0.0086,
                    0.0029,
                    0.004,
                    0.006,
                    0.0065,
                    0.0005,
                    0.0098,
                    0.0094,
                    0.2141,
                    0.0064,
                    0.0026,
                    0.0054,
                    0.0005,
                    0.0,
                    0.0001,
                    0.0001,
                    0.1931,
                    0.0003,
                    0.0013,
                    0.0,
                    0.0,
                    0.0024,
                    0.0018,
                    0.0057,
                    0.0001,
                    0.0,
                    0.0017,
                    0.0003,
                    0.0004,
                    0.0006,
                    0.0002,
                    0.11,
                    0.0013,
                    0.1075,
                    0.0001,
                    0.0,
                    0.0,
                    0.002,
                    0.0024,
                    0.0,
                    0.0,
                    0.0005,
                    0.0198,
                    0.0,
                    0.0012,
                    0.0004,
                    0.0004,
                    0.0001,
                    0.0001,
                    0.0003,
                    0.0002,
                    0.0113,
                    0.0457,
                    0.0002,
                    0.0008,
                    0.0009,
                    0.2611,
                    0.0003,
                    0.0004,
                    0.0057
                ],
                "tension": 0.1
            },
            {
                "label": "大盘价值",
                "data": [
                    0.0055,
                    0.0572,
                    0.0066,
                    0.0035,
                    0.0061,
                    0.0285,
                    0.0056,
                    0.0209,
                    0.0064,
                    0.0101,
                    0.0053,
                    0.028,
                    0.0298,
                    0.0088,
                    0.0161,
                    0.0127,
                    0.0061,
                    0.0005,
                    0.0108,
                    0.0055,
                    0.004,
                    0.0008,
                    0.0016,
                    0.0283,
                    0.0273,
                    0.0,
                    0.0013,
                    0.0001,
                    0.0056,
                    0.0401,
                    0.0032,
                    0.0,
                    0.0001,
                    0.0002,
                    0.0279,
                    0.0234,
                    0.0003,
                    0.0,
                    0.0019,
                    0.0005,
                    0.0009,
                    0.0431,
                    0.0001,
                    0.2113,
                    0.0046,
                    0.1375,
                    0.1907,
                    0.0001,
                    0.0,
                    0.0,
                    0.0436,
                    0.0,
                    0.0,
                    0.0015,
                    0.0394,
                    0.0,
                    0.0002,
                    0.0002,
                    0.0001,
                    0.0,
                    0.0,
                    0.0009,
                    0.0,
                    0.0,
                    0.0002,
                    0.0001,
                    0.0013,
                    0.0004,
                    0.0237,
                    0.0,
                    0.0002,
                    0.0004
                ],
                "tension": 0.1
            },
            {
                "label": "小盘成长",
                "data": [
                    0.0101,
                    0.0308,
                    0.0079,
                    0.0014,
                    0.0044,
                    0.0264,
                    0.1314,
                    0.0299,
                    0.0078,
                    0.0006,
                    0.0041,
                    0.0044,
                    0.012,
                    0.0051,
                    0.0026,
                    0.0108,
                    0.2701,
                    0.3988,
                    0.1881,
                    0.1169,
                    0.2738,
                    0.1347,
                    0.1675,
                    0.3132,
                    0.001,
                    0.0,
                    0.0622,
                    0.1215,
                    0.2743,
                    0.2358,
                    0.0587,
                    0.1645,
                    0.5398,
                    0.0113,
                    0.2527,
                    0.4443,
                    0.0004,
                    0.0001,
                    0.009,
                    0.0022,
                    0.0003,
                    0.0032,
                    0.1359,
                    0.0214,
                    0.1505,
                    0.0877,
                    0.0034,
                    0.0849,
                    0.1721,
                    0.0038,
                    0.0221,
                    0.4525,
                    0.0941,
                    0.3908,
                    0.0009,
                    0.1391,
                    0.0765,
                    0.5226,
                    0.01,
                    0.0931,
                    0.1024,
                    0.3441,
                    0.1723,
                    0.0036,
                    0.0241,
                    0.0008,
                    0.2754,
                    0.24,
                    0.2741,
                    0.0234,
                    0.0757,
                    0.0098
                ],
                "tension": 0.1
            },
            {
                "label": "小盘价值",
                "data": [
                    0.0059,
                    0.0127,
                    0.0071,
                    0.0057,
                    0.0055,
                    0.0128,
                    0.0677,
                    0.0294,
                    0.0085,
                    0.0703,
                    0.0023,
                    0.0066,
                    0.0168,
                    0.0096,
                    0.0031,
                    0.0111,
                    0.0777,
                    0.0633,
                    0.2131,
                    0.3789,
                    0.1662,
                    0.5894,
                    0.4046,
                    0.2902,
                    0.8313,
                    0.883,
                    0.7407,
                    0.8088,
                    0.1186,
                    0.4258,
                    0.5993,
                    0.4225,
                    0.1715,
                    0.6975,
                    0.1968,
                    0.0637,
                    0.6472,
                    0.4998,
                    0.3276,
                    0.612,
                    0.2323,
                    0.3422,
                    0.2862,
                    0.1992,
                    0.3488,
                    0.2446,
                    0.2785,
                    0.4307,
                    0.6924,
                    0.6119,
                    0.5614,
                    0.2786,
                    0.5698,
                    0.1671,
                    0.7271,
                    0.5665,
                    0.7048,
                    0.2201,
                    0.5419,
                    0.5264,
                    0.7241,
                    0.0952,
                    0.7053,
                    0.9848,
                    0.4372,
                    0.8694,
                    0.2537,
                    0.4735,
                    0.107,
                    0.914,
                    0.4255,
                    0.9254
                ],
                "tension": 0.1
            },
            {
                "label": "中债总财富",
                "data": [
                    0.9728,
                    0.872,
                    0.9733,
                    0.9844,
                    0.9787,
                    0.905,
                    0.7854,
                    0.8909,
                    0.9723,
                    0.7832,
                    0.9858,
                    0.9564,
                    0.9328,
                    0.9736,
                    0.9743,
                    0.9594,
                    0.6396,
                    0.5369,
                    0.5781,
                    0.4893,
                    0.3419,
                    0.2687,
                    0.4238,
                    0.3629,
                    0.1399,
                    0.1169,
                    0.1957,
                    0.0694,
                    0.4084,
                    0.298,
                    0.3376,
                    0.4129,
                    0.2886,
                    0.2886,
                    0.5207,
                    0.4629,
                    0.3519,
                    0.5001,
                    0.6598,
                    0.3851,
                    0.7662,
                    0.6109,
                    0.5777,
                    0.4581,
                    0.495,
                    0.4227,
                    0.5274,
                    0.4842,
                    0.1355,
                    0.3823,
                    0.3705,
                    0.2689,
                    0.336,
                    0.44,
                    0.2129,
                    0.2943,
                    0.2173,
                    0.2567,
                    0.4476,
                    0.3804,
                    0.1734,
                    0.5595,
                    0.1221,
                    0.0002,
                    0.4927,
                    0.1295,
                    0.4688,
                    0.2852,
                    0.3341,
                    0.0622,
                    0.4982,
                    0.0587
                ],
                "tension": 0.1
            }
        ]
    },
    "options": {
        "responsive": true,
        "scales": {
            "x": {
                "stacked": true
            },
            "y": {
                "stacked": true,
                "max": 1
            }
        }
    }
}
```

:::


### 源码获取

可以从[github](https://github.com/PengchuanC/arcticles/codes/rbsa/)上获取到相关数据和处理代码，整体计算还是偏简单的。