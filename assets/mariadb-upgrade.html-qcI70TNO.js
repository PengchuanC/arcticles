import{_ as e}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as a,c as s,e as d}from"./app-0P0B6JVZ.js";const i={},n=d(`<h1 id="_1-事情起因" tabindex="-1"><a class="header-anchor" href="#_1-事情起因" aria-hidden="true">#</a> 1.事情起因</h1><p>在redhat每次执行完<code>yun update</code>后，MariaDB也会升级，但我之前更换过MariaDB的数据存储目录，将数据保存在了<code>/home/mysql</code>目录下，导致每次升级完MariaDB后，无法启动server。</p><h1 id="_2-解决方案" tabindex="-1"><a class="header-anchor" href="#_2-解决方案" aria-hidden="true">#</a> 2.解决方案</h1><h2 id="_2-1-更换目录" tabindex="-1"><a class="header-anchor" href="#_2-1-更换目录" aria-hidden="true">#</a> 2.1 更换目录</h2><p>更换目录后，需要对目录重新授权，因为默认情况下，MariaDB的用户和用户组为<code>mysql:mysql</code>，授权代码为：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ <span class="token function">chown</span> <span class="token parameter variable">-R</span> mysql:mysql /home/mysql
~ <span class="token function">chown</span> <span class="token number">775</span> /home/mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-2-关闭selinux" tabindex="-1"><a class="header-anchor" href="#_2-2-关闭selinux" aria-hidden="true">#</a> 2.2 关闭selinux</h2><p>通过一下命令可以临时关闭selinux：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ setenforce <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>要永久禁用selinux，可以使用文本编辑器打开<code>/etc/sysconfig/selinux</code>文件，如下所示：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ <span class="token function">vi</span> /etc/sysconfig/selinux
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后将配置selinux=enforcing改为selinux=disabled，如下图所示。</p><div class="language-plain line-numbers-mode" data-ext="plain"><pre class="language-plain"><code>SELINUX=disabled
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后，按<code>esc</code>按键后，输入<code>:wq</code>保存并退出文件，为了使配置生效，需要重新启动系统，然后使用sestatus命令检查selinux的状态，如下所示：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>sestatus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-3-修改mariadb-service" tabindex="-1"><a class="header-anchor" href="#_2-3-修改mariadb-service" aria-hidden="true">#</a> 2.3 修改<code>mariadb.service</code></h2><p>systemd 默认配置了对<code>/root</code>和<code>/home</code>等目录的限制，<code>ProtectHome=true</code>配置意味着启动时应用对这些目录不可写，mariaDB同样有这个限制。</p><p>通过以下命令可以找到<code>mriadb.service</code>的位置:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ <span class="token function">find</span> / <span class="token parameter variable">-name</span> <span class="token string">&quot;mariadb.service&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后使用<code>vi</code> 编辑文件，通过以下命令可以找到<code>ProtectHome</code>的位置:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">:</span> /ProtectHome*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>找到配置位置后，将<code>ProtectHome=true</code>修改为<code>ProtectHome=false</code>，保存并退出。</p><p>执行一下命令来重启MariaDB：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>~ systemctl daemon-reload
~ systemctl restart mariadb.servic
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_3-总结" tabindex="-1"><a class="header-anchor" href="#_3-总结" aria-hidden="true">#</a> 3. 总结</h1><p>实际上问题的出现来源于三个方面</p><ul><li>更换mariadb目录没有对目录进行授权</li><li>selinux</li><li>systemd 默认配置了对<code>/root</code>和<code>/home</code>等目录的限制</li></ul>`,27),r=[n];function c(l,o){return a(),s("div",null,r)}const m=e(i,[["render",c],["__file","mariadb-upgrade.html.vue"]]);export{m as default};
